<?php namespace App\Http\Controllers; use Illuminate\Http\Request;use Illuminate\Support\Facades\Auth;use Illuminate\Support\Facades\Hash;use App\User;use App\Datos;use Illuminate\Support\Facades\DB;class AuthController extends Controller{public function establecer(Request $request){$request->validate(['name'=>'required|exists:users,name','email'=>'required|exists:users,email','password'=> 'required|min:6']);$id = DB::table('users')->where([['name', $request->name],['email', $request->email],])->select('id')->first();$user = User::find($id->id);$user->password = Hash::make($request->password);$user->save();return response()->json([$user]);}public function registro(Request $request){$request->validate(['name'=> 'required','email'=>'required|email|unique:users','password'=>'required|min:6']);$user=User::create(['name' => $request->name,'email' => $request->email,'password' => Hash::make($request->password)]);$user->save();$token = $user->createToken($user->email.'-'.now());return response()->json(['user'=>$user,'token'=>$token->accessToken]);}public function login(Request $request){$request->validate(['name'=>'required|exists:users,name','password'=> 'required|min:6']);if(Auth::attempt(['name'=>$request->name,'password'=>$request->password])){$user=Auth::user();$token = $user->createToken($user->email.'-'.now());return response()->json(['token'=>$token->accessToken,'user'=>$user]);}else{return response()->json(['error'=>"unauthorized"]);}}public function cambiar(Request $request){$request->validate(['name'=>'required|exists:users,name','email'=> 'required|exists:users,email']);}public function datos(Request $request){$datos = Datos::find(1);return response()->json([$datos]);}public function user(Request $request){return response()->json($request->user());}}